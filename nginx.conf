  server {
      listen 80;
      server_name localhost;

      # Required headers for ffmpeg.wasm and SharedArrayBuffer
      add_header Cross-Origin-Opener-Policy same-origin;
      add_header Cross-Origin-Embedder-Policy require-corp;
      
      # Proper MIME type for WASM files
      location ~* \.wasm$ {
          add_header Content-Type application/wasm;
          add_header Cross-Origin-Opener-Policy same-origin;
          add_header Cross-Origin-Embedder-Policy require-corp;
      }

      location / {
          root   /usr/share/nginx/html;
          index  index.html index.htm;
          try_files $uri $uri/ /index.html;
          
          # Ensure headers are set for all responses
          add_header Cross-Origin-Opener-Policy same-origin;
          add_header Cross-Origin-Embedder-Policy require-corp;
      }

      location /api/cameras/ {
          proxy_pass https://webcams.nyctmc.org/api/cameras/;
          proxy_set_header Host webcams.nyctmc.org;
          proxy_set_header User-Agent "Mozilla/5.0 (compatible; NYC-GIF-Creator)";
          proxy_ssl_verify off;
      }
  }